---
sidebar: sidebar 
permalink: troubleshooting_collector_svm.html 
keywords: data collector, ONTAP, NetApp, SVM, cloud ontap, firewall 
summary: 워크로드 보안 데이터 수집기 문제 해결 
---
= ONTAP SVM 데이터 수집기 ​​문제 해결
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
워크로드 보안은 데이터 수집기를 사용하여 장치에서 파일 및 사용자 액세스 데이터를 수집합니다.  여기에서는 이 수집기와 관련된 문제를 해결하기 위한 팁을 찾을 수 있습니다.

를 참조하십시오link:task_add_collector_svm.html["SVM 수집기 구성"] 이 수집기를 구성하는 방법에 대한 지침은 페이지를 참조하세요.

오류가 발생한 경우, 설치된 데이터 수집기 페이지의 _상태_ 열에서 _자세한 내용_을 클릭하면 오류에 대한 자세한 내용을 볼 수 있습니다.

image:CS_Data_Collector_Error.png["워크로드 보안 수집기 오류 자세한 링크"]

알려진 문제와 해결 방법은 아래와 같습니다.

'''
*문제:* 데이터 수집기가 잠시 실행되다가 임의의 시간 후에 중지되고 "오류 메시지: 커넥터가 오류 상태입니다."라는 오류 메시지가 나타납니다. 서비스 이름: 감사. 실패 이유: 외부 fpolicy 서버가 과부하되었습니다. *다음을 시도해 보세요.* ONTAP 의 이벤트 비율은 에이전트 상자가 처리할 수 있는 것보다 훨씬 높았습니다. 그래서 연결이 종료되었습니다.

연결이 끊어졌을 때 CloudSecure에서 최대 트래픽을 확인하세요.  *CloudSecure > 활동 포렌식 > 모든 활동* 페이지에서 확인할 수 있습니다.

최대 집계 트래픽이 Agent Box에서 처리할 수 있는 것보다 높은 경우 Agent Box에서 Collector 배포 크기를 조정하는 방법에 대한 이벤트 속도 검사기 페이지를 참조하세요.

2021년 3월 4일 이전에 에이전트가 에이전트 상자에 설치된 경우 에이전트 상자에서 다음 명령을 실행하세요.

....
echo 'net.core.rmem_max=8388608' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_rmem = 4096 2097152 8388608' >> /etc/sysctl.conf
sysctl -p
....
크기를 조정한 후 UI에서 수집기를 다시 시작합니다.

{비어 있는}

****

****
*문제:* 수집기에서 "SVM의 데이터 인터페이스에 도달할 수 있는 커넥터에서 로컬 IP 주소를 찾을 수 없습니다"라는 오류 메시지가 보고됩니다.  *다음을 시도해 보세요:* 이는 ONTAP 측의 네트워킹 문제로 인해 발생할 가능성이 가장 높습니다.  다음 단계를 따르세요.

. SVM 데이터 영역이나 관리 영역에 SVM의 연결을 차단하는 방화벽이 없는지 확인하세요.
. 클러스터 관리 IP를 통해 SVM을 추가하는 경우 에이전트 VM에서 SVM의 데이터 레벨과 관리 레벨에 ping을 보낼 수 있는지 확인하세요.  문제가 발생한 경우, 해당 게이트웨이, 넷마스크, 경로를 확인하세요.
+
클러스터 관리 IP를 사용하여 ssh를 통해 클러스터에 로그인하고 에이전트 IP를 ping해 볼 수도 있습니다.  에이전트 IP가 ping 가능한지 확인하세요.

+
 network ping -vserver <vserver name> -destination <Agent IP> -lif <Lif Name> -show-detail
+
ping을 사용할 수 없는 경우 ONTAP 의 네트워크 설정이 올바른지 확인하여 Agent 머신이 ping을 사용할 수 있도록 하세요.

. 클러스터 IP를 통해 연결을 시도했지만 작동하지 않는 경우 SVM IP를 통해 직접 연결을 시도하세요.  SVM IP를 통해 연결하는 단계는 위를 참조하세요.
. SVM IP 및 vsadmin 자격 증명을 통해 수집기를 추가하는 동안 SVM Lif에 데이터 및 관리 역할이 활성화되어 있는지 확인하세요.  이 경우 SVM Lif에 대한 ping은 작동하지만 SVM Lif에 대한 SSH는 작동하지 않습니다.  그렇다면 SVM 관리 전용 Lif를 만들고 이 SVM 관리 전용 Lif를 통해 연결을 시도하세요.
. 그래도 작동하지 않는다면 새로운 SVM Lif를 생성하고 해당 Lif를 통해 연결을 시도해보세요.  서브넷 마스크가 올바르게 설정되었는지 확인하세요.
. 고급 디버깅:
+
.. ONTAP 에서 패킷 추적을 시작합니다.
.. CloudSecure UI에서 SVM에 데이터 수집기를 연결해 보세요.
.. 오류가 나타날 때까지 기다리세요.  ONTAP 에서 패킷 추적을 중지합니다.
.. ONTAP 에서 패킷 추적을 엽니다.  이 위치에서 사용 가능합니다
+
 https://<cluster_mgmt_ip>/spi/<clustername>/etc/log/packet_traces/
.. ONTAP 에서 Agent 상자로 SYN이 있는지 확인하세요.
.. ONTAP 에서 SYN이 없으면 ONTAP 의 방화벽에 문제가 있습니다.
.. ONTAP 에서 방화벽을 열어 ONTAP 에이전트 상자에 연결할 수 있도록 합니다.


. 그래도 작동하지 않으면 네트워킹 팀에 문의하여 외부 방화벽이 ONTAP 에서 Agent 상자로의 연결을 차단하고 있지 않은지 확인하세요.
. 위의 방법으로도 문제가 해결되지 않으면 사례를 열어주세요.link:concept_requesting_support.html["넷앱 지원"] 추가 지원이 필요하면.


{비어 있는}

'''
*문제:* 메시지: "[호스트 이름: <IP 주소>에 대한 ONTAP 유형을 확인하지 못했습니다.  이유: 스토리지 시스템 <IP 주소>에 대한 연결 오류: 호스트에 접근할 수 없습니다(Host unreachable)" *다음을 시도해 보세요:*

. 올바른 SVM IP 관리 주소 또는 클러스터 관리 IP가 제공되었는지 확인하세요.
. 연결하려는 SVM이나 클러스터에 SSH를 실행합니다.  연결되면 SVM 또는 클러스터 이름이 올바른지 확인하세요.


{비어 있는}

'''
*문제:* 오류 메시지: "커넥터가 오류 상태입니다.  서비스 이름: 감사.  실패 이유: 외부 fpolicy 서버가 종료되었습니다.  *이걸 시도해보세요:*

. 방화벽이 에이전트 머신의 필수 포트를 차단하고 있을 가능성이 큽니다.  에이전트 머신이 SVM에서 연결할 수 있도록 포트 범위 35000-55000/tcp가 열려 있는지 확인하세요.  또한 ONTAP 측에서 에이전트 머신과의 통신을 차단하는 방화벽이 활성화되어 있지 않은지 확인하세요.
. 에이전트 상자에 다음 명령을 입력하고 포트 범위가 열려 있는지 확인하세요.
+
 sudo iptables-save | grep 3500*
+
샘플 출력은 다음과 같습니다.

+
 -A IN_public_allow -p tcp -m tcp --dport 35000 -m conntrack -ctstate NEW -j ACCEPT
. SVM에 로그인하고 다음 명령을 입력한 후 ONTAP 과의 통신을 차단하는 방화벽이 설정되어 있지 않은지 확인합니다.
+
....
system services firewall show
system services firewall policy show
....
+
link:https://docs.netapp.com/ontap-9/index.jsp?topic=%2Fcom.netapp.doc.dot-cm-nmg%2FGUID-969851BB-4302-4645-8DAC-1B059D81C5B2.html["방화벽 명령 확인"]ONTAP 측에서.

. 모니터링하려는 SVM/클러스터에 SSH를 실행합니다.  SVM 데이터 lif(CIFS, NFS 프로토콜 지원)에서 Agent 상자에 ping을 보내고 ping이 작동하는지 확인합니다.
+
 network ping -vserver <vserver name> -destination <Agent IP> -lif <Lif Name> -show-detail
+
ping을 사용할 수 없는 경우 ONTAP 의 네트워크 설정이 올바른지 확인하여 Agent 머신이 ping을 사용할 수 있도록 하세요.

. 2개의 데이터 수집기를 통해 하나의 SVM이 테넌트에 두 번 추가되면 이 오류가 표시됩니다.  UI를 통해 데이터 수집기 중 하나를 삭제합니다.  그런 다음 UI를 통해 다른 데이터 수집기를 다시 시작합니다.  그러면 데이터 수집기가 "실행 중" 상태를 표시하고 SVM에서 이벤트를 수신하기 시작합니다.
+
기본적으로 테넌트에서는 1개의 SVM이 1개의 데이터 수집기를 통해 한 번만 추가되어야 합니다.  1 SVM은 2개의 데이터 수집기를 통해 두 번 추가되어서는 안 됩니다.

. 두 개의 서로 다른 워크로드 보안 환경(테넌트)에 동일한 SVM이 추가된 경우, 항상 마지막에 추가된 SVM이 성공합니다.  두 번째 수집기는 자체 IP 주소로 fpolicy를 구성하고 첫 번째 수집기를 제거합니다.  따라서 첫 번째 수집기는 이벤트 수신을 중단하고 해당 "감사" 서비스는 오류 상태로 전환됩니다.  이를 방지하려면 각 SVM을 단일 환경에 구성하세요.
. 서비스 정책이 올바르게 구성되지 않은 경우에도 이 오류가 발생할 수 있습니다.  ONTAP 9.8 이상에서 데이터 소스 수집기에 연결하려면 data-nfs 및/또는 data-cifs 데이터 서비스와 함께 data-fpolicy-client 서비스가 필요합니다.  또한, data-fpolicy-client 서비스는 모니터링되는 SVM의 데이터 라이프와 연결되어야 합니다.


{비어 있는}

'''
*문제:* 활동 페이지에서 이벤트가 보이지 않습니다.  *이걸 시도해보세요:*

. ONTAP 수집기가 "실행 중" 상태인지 확인하세요.  그렇다면 일부 파일을 열어서 cifs 클라이언트 VM에서 일부 cifs 이벤트가 생성되는지 확인하세요.
. 활동이 보이지 않으면 SVM에 로그인하여 다음 명령을 입력하세요.
+
 <SVM>event log show -source fpolicy
+
fpolicy와 관련된 오류가 없는지 확인하세요.

. 활동이 보이지 않으면 SVM에 로그인하세요. 다음 명령을 입력하세요:
+
 <SVM>fpolicy show
+
"cloudsecure_" 접두사가 붙은 fpolicy 정책이 설정되었고 상태가 "on"인지 확인하세요.  설정하지 않으면 에이전트가 SVM에서 명령을 실행할 수 없을 가능성이 큽니다.  이 페이지의 시작 부분에 설명된 모든 전제 조건이 충족되었는지 확인하세요.



{비어 있는}

****

****
*문제:* SVM 데이터 수집기가 오류 상태이며 오류 메시지는 "에이전트가 수집기에 연결하지 못했습니다"입니다. *다음을 시도해 보세요.*

. 에이전트가 과부하되어 데이터 소스 수집기에 연결할 수 없는 것 같습니다.
. 에이전트에 연결된 데이터 소스 수집기의 수를 확인합니다.
. 또한 UI의 "모든 활동" 페이지에서 데이터 흐름 속도를 확인하세요.
. 초당 활동 수가 상당히 높은 경우 다른 에이전트를 설치하고 일부 데이터 소스 수집기를 새 에이전트로 이동합니다.


{비어 있는}

'''
*문제:* SVM 데이터 수집기가 "fpolicy.server.connectError: 노드가 FPolicy 서버 "12.195.15.146"과 연결을 설정하지 못했습니다(이유: "선택 시간 초과")"라는 오류 메시지를 표시합니다. *다음을 시도해 보세요:* SVM/클러스터에서 방화벽이 활성화되어 있습니다.  따라서 fpolicy 엔진이 fpolicy 서버에 연결할 수 없습니다.  더 많은 정보를 얻는 데 사용할 수 있는 ONTAP 의 CLI는 다음과 같습니다.

....
event log show -source fpolicy which shows the error
event log show -source fpolicy -fields event,action,description which shows more details.
....
link:https://docs.netapp.com/ontap-9/index.jsp?topic=%2Fcom.netapp.doc.dot-cm-nmg%2FGUID-969851BB-4302-4645-8DAC-1B059D81C5B2.html["방화벽 명령 확인"]ONTAP 측에서.

{비어 있는}

****

****
*문제:* 오류 메시지: "커넥터가 오류 상태입니다.  서비스 이름: 감사.  실패 이유: SVM에서 유효한 데이터 인터페이스(역할: 데이터, 데이터 프로토콜: NFS 또는 CIFS 또는 둘 다, 상태: 작동)를 찾을 수 없습니다.  *다음을 시도해 보세요.* CIFS/NFS로서 데이터 역할과 데이터 프로토콜을 갖는 운영 인터페이스가 있는지 확인하세요.

{비어 있는}

'''
*문제:* 데이터 수집기가 오류 상태로 전환된 후 얼마 후 실행 상태로 전환되고 다시 오류 상태로 돌아갑니다.  이런 순환이 반복됩니다.  *다음을 시도해 보세요:* 이는 일반적으로 다음 시나리오에서 발생합니다.

. 여러 개의 데이터 수집기가 추가되었습니다.
. 이런 종류의 행동을 보이는 데이터 수집기에는 해당 데이터 수집기에 1개의 SVM이 추가됩니다.  즉, 2개 이상의 데이터 수집기가 1개의 SVM에 연결되어 있습니다.
. 1개의 데이터 수집기가 1개의 SVM에만 연결되도록 하세요.
. 동일한 SVM에 연결된 다른 데이터 수집기를 삭제합니다.


{비어 있는}

'''
*문제:* 커넥터가 오류 상태입니다.  서비스 이름: 감사.  실패 이유: (SVM svmname에 대한 정책을 구성하지 못했습니다.)  이유: 'fpolicy.policy.scope-modify: "Federal'' 내의 'shares-to-include' 요소에 잘못된 값이 지정되었습니다. *다음을 시도해 보세요.* *공유 이름은 따옴표 없이 지정해야 합니다.  ONTAP SVM DSC 구성을 편집하여 공유 이름을 수정합니다.

_주식 포함 및 제외_는 긴 주식 이름 목록에는 적용되지 않습니다.  포함하거나 제외할 주식 수가 많은 경우 대신 거래량별 필터링을 사용하세요.

{비어 있는}

'''
*문제:* 클러스터에 사용되지 않는 기존 fpolicies가 있습니다.  Workload Security를 설치하기 전에 무엇을 해야 합니까?  *다음을 시도해 보세요.* 연결이 끊긴 상태라도 기존의 사용되지 않는 모든 fpolicy 설정을 삭제하는 것이 좋습니다.  Workload Security는 "cloudsecure_" 접두사로 fpolicy를 생성합니다.  나머지 사용되지 않는 fpolicy 구성은 모두 삭제할 수 있습니다.

fpolicy 목록을 표시하는 CLI 명령:

 fpolicy show
fpolicy 구성을 삭제하는 단계:

....
fpolicy disable -vserver <svmname> -policy-name <policy_name>
fpolicy policy scope delete -vserver <svmname> -policy-name <policy_name>
fpolicy policy delete -vserver <svmname> -policy-name <policy_name>
fpolicy policy event delete -vserver <svmname> -event-name <event_list>
fpolicy policy external-engine delete -vserver <svmname> -engine-name <engine_name>
....
{비어 있는}

'''
*문제점:* 워크로드 보안을 활성화한 후 ONTAP 성능에 문제가 발생합니다. 지연 시간이 간헐적으로 높아지고, IOP가 간헐적으로 낮아집니다.  *다음과 같이 시도해 보세요:* ONTAP 워크로드 보안과 함께 사용할 때 ONTAP 에서 지연 문제가 발생할 수 있습니다.  다음과 같이 몇 가지 가능한 이유가 있습니다.link:https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1372994["1372994"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1415152["1415152"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1438207["1438207"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1479704["1479704"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1354659["1354659"] . 이러한 문제는 모두 ONTAP 9.13.1 이상에서 해결되었습니다. 이후 버전 중 하나를 사용하는 것이 좋습니다.

{비어 있는}

'''
*문제:* 데이터 수집기에서 다음 오류 메시지가 표시됩니다. "오류: 2번의 재시도 내에 수집기의 상태를 확인하지 못했습니다. 수집기를 다시 시작해 보세요(오류 코드: AGENT008)".  *이걸 시도해보세요:*

. 데이터 수집기 페이지에서 오류가 발생한 데이터 수집기의 오른쪽으로 스크롤하여 3개 점 메뉴를 클릭합니다.  _편집_을 선택하세요.  데이터 수집기의 비밀번호를 다시 입력하세요.  _저장_ 버튼을 눌러 데이터 수집기를 저장합니다.  데이터 수집기가 다시 시작되면 오류가 해결될 것입니다.
. 에이전트 머신에는 CPU나 RAM 여유 공간이 충분하지 않아 DSC가 실패하는 것입니다.  머신의 에이전트에 추가된 데이터 수집기의 수를 확인하세요.  20이 넘을 경우, Agent 머신의 CPU와 RAM 용량을 늘려주세요.  CPU와 RAM이 늘어나면 DSC는 초기화 상태로 전환되고, 그다음에는 자동으로 실행 상태로 전환됩니다.  사이즈 가이드를 살펴보세요link:concept_cs_event_rate_checker.html["이 페이지"] .


{비어 있는}

'''
*문제:* SVM 모드를 선택하면 데이터 수집기에서 오류가 발생합니다.  *다음을 시도해 보세요.* SVM 모드에서 연결하는 동안 SVM 관리 IP 대신 클러스터 관리 IP를 사용하여 연결하면 연결 오류가 발생합니다.  올바른 SVM IP가 사용되었는지 확인하세요.

{비어 있는}

'''
*문제:* 액세스 거부 기능이 활성화된 경우 데이터 수집기에서 "커넥터가 오류 상태입니다."라는 오류 메시지가 표시됩니다.  서비스 이름: 감사.  실패 이유: SVM test_svm에서 fpolicy를 구성하지 못했습니다.  사유: 사용자에게 권한이 없습니다.  *다음을 시도해 보세요.* 사용자에게 액세스 거부 기능에 필요한 REST 권한이 없을 수 있습니다.  다음 지침을 따르십시오.link:concept_ws_integration_with_ontap_access_denied.html["이 페이지"] 권한을 설정하려면.

권한이 설정되면 수집기를 다시 시작합니다.

{비어 있는}

'''
*문제:* 컬렉터가 "커넥터가 오류 상태입니다"라는 메시지와 함께 오류 상태에 있습니다.  실패 원인: SVM <SVM 이름>에 영구 저장소를 구성하는 데 실패했습니다.  이유: SVM "<SVM 이름>"에서 볼륨 "<볼륨 이름>"에 적합한 집계를 찾을 수 없습니다.  이유: 현재 집계 "<aggregateName>"에 대한 성능 정보를 사용할 수 없습니다.  몇 분 기다렸다가 명령어를 다시 시도해 보세요. 서비스 이름: 감사. 실패 이유: SVM에서 영구 저장소를 구성하지 못했습니다 <svm name="">.</svm> 이유: <volumename>SVM "<svm name="">"</svm>에서</volumename> 볼륨 ""에 적합한 애그리게이트를 찾을 수 없습니다. 이유: 애그리게이트 ""에 대한 성능 정보를 <aggregatename>현재 사용할 수 없습니다.</aggregatename> 몇 분 정도 기다렸다가 명령을 다시 시도하십시오.

*다음 방법을 시도해 보세요:* 몇 분 정도 기다린 후 수집기를 다시 시작하세요.

{비어 있는}

'''
여전히 문제가 발생하는 경우, *도움말 > 지원* 페이지에 언급된 지원 링크로 문의하세요.
