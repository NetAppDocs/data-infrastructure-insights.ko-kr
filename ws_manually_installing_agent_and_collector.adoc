---
sidebar: sidebar 
permalink: ws_manually_installing_agent_and_collector.html 
keywords: install, configure, agent, collector, workload, security, cloud secure 
summary: Workload Security 에이전트는 수동으로 설치하거나 업데이트할 수 있으므로 테넌트에 설치된 소프트웨어를 보다 효과적으로 제어할 수 있습니다. 
---
= Workload Security Agent 및 Collector 수동 설치
:hardbreaks:
:allow-uri-read: 


[role="lead"]
기본적으로 Workload Security 에이전트나 수집기의 새 버전이 출시되면 사전 업그레이드 알림이 전송되고 테넌트에서 에이전트와 수집기가 자동으로 업데이트됩니다.  그러나 보안이 강화된 통제 환경에서는 자동 업그레이드가 바람직하지 않을 수 있습니다.  이러한 경우 Workload Security를 에이전트와 수집기의 수동 설치/업그레이드에 맞게 구성하여 시스템에 설치된 소프트웨어를 더욱 효과적으로 제어할 수 있습니다.



== 시작하기 전에

. swagger에서 "cloudsecure_installers.agent" 및 "cloudsecure_installers.collector"라는 API 범주를 사용할 수 있는지 확인합니다.  그렇지 않으면 수동 에이전트 설치에 대한 지원이 활성화되지 않습니다.  해당 기능을 활성화하려면 NetApp 지원팀에 문의하세요.
+
image:ws_manual_install_APIs.png["수동 설치 API"]

. 이 문서에 언급된 모든 명령을 'root' 사용자로 실행하거나, 다른 사용자로 실행하는 경우 'sudo'로 명령을 실행하세요.




== 새 에이전트 설치

. 새로운 Workload Security API 액세스 토큰을 만듭니다.
+
.. *관리자 > API 액세스*로 이동합니다.  "워크로드 보안 토큰" 탭을 선택하고 "+ API 액세스 토큰"을 클릭합니다.
+
... 식별하기 쉬운 이름과 설명을 설정하세요.
... "이 토큰은 어떤 유형의 API를 호출하는 데 사용됩니까?" 드롭다운에서 _수집기 관리_ 및 _에이전트 및 수집기 설치_를 선택합니다.
... 원하는 만료 기간을 선택하세요.


.. _저장_을 클릭하세요.




[[copy-access-token]]
. 생성된 API 액세스 토큰을 복사합니다.  창이 닫히면 토큰을 더 이상 검색할 수 없습니다.  그런 경우에는 새로운 토큰을 생성해야 합니다.
+
image:ws_create_and_save_token.png["API 토큰 생성 및 저장"]

+
image:ws_create_and_save_token_confirm.png["토큰 생성 확인"]

+
.. *관리자 > API 액세스 > API 문서*(페이지 오른쪽 상단)로 이동하여 _워크로드 보안_ 아이콘을 선택합니다.  이렇게 하면 Workload Security API에 대한 Swagger 문서가 열립니다.
+
image:ws_swagger_documentation_link.png["워크로드 보안을 위한 Swagger 문서"]

.. _워크로드 보안_ API에 대한 액세스를 승인합니다.


. 페이지 오른쪽 상단의 _승인_ 버튼을 클릭하세요.
. _Customer ApiKey (apiKey)_ 텍스트 필드에 이전에 복사한 API 토큰을 붙여넣습니다.<<copy-access-token,1c 단계>> .
. _승인_을 클릭하고 창을 닫습니다.
+
image:ws_API_authorization.png["API 승인"]

+
.. 에이전트 설치 프로그램을 다운로드하세요.


. Swagger에서 _cloudsecure_installers.agent_ > _/v1/cloudsecure/agents/installers/{platform}/latest_ (GET) API를 선택합니다.  _시도해보기_를 클릭하세요.
. _플랫폼_ 필드에 _linux_를 입력합니다.  _실행_을 클릭합니다.
+
image:ws_installers_agent_api_swagger.png["에이전트 설치 프로그램 API를 위한 Swagger - 최상위"] image:ws_installers_agent_api_swagger-2.png["에이전트 설치 프로그램 API용 Swagger - 응답"]

. '파일 다운로드'를 클릭하여 설치 프로그램을 다운로드하세요.
. 에이전트를 설치할 시스템이 아닌 다른 컴퓨터에 설치 프로그램 파일을 외부에서 다운로드한 경우, 해당 시스템에 설치 프로그램 파일을 복사합니다.
. 혹은 curl 명령어를 복사하여 에이전트가 설치될 시스템에서 직접 실행할 수도 있습니다.
+
** 원하는 이름으로 설치 프로그램 파일을 저장하려면 curl 명령에 "-o {{file_name}}" 인수를 추가합니다.  설치 프로그램 파일의 실제 이름은 swagger 응답 헤더 섹션에서 확인할 수 있습니다.  그 이름도 사용될 수 있습니다.
+
image:ws_installers_agent_api_swagger_installer_file.png["API를 통한 최신 에이전트 선택 - Swagger"]

** 파일은 어느 위치에나 다운로드할 수 있지만, 설치 프로그램 .zip을 추출할 수 있는 빈 폴더에 다운로드하는 것이 좋습니다.
+
... 새 폴더를 만들고(권장), 설치 프로그램 파일을 이 폴더에 복사한 후 압축을 풉니다.
+
[listing]
----
[root@demo-agent /]# mkdir agent_installers
[root@demo-agent /]# cd agent_installers/
[root@demo-agent agent_installers]# pwd
/agent_installers
[root@demo-agent agent_installers]# ll
total 0
[root@demo-agent agent_installers]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/agents/installers/linux/latest" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cloudsecure-linux-agent-installer-1.617.0.zip
[root@demo-agent agent_installers]# ll
total 76012
-rw------- 1 root root 77834705 Apr 26 14:34 cloudsecure-linux-agent-installer-1.617.0.zip
----
+
[listing]
----
[root@demo-agent agent_installers]# unzip cloudsecure-linux-agent-installer-1.617.0.zip
Archive:  cloudsecure-linux-agent-installer-1.617.0.zip
  inflating: cloudsecure-agent-image.zip
  inflating: cloudsecure-agent-install.sh
  inflating: cloudsecure-agent-upgrade.sh
----
... “cloudsecure-agent-install.sh” 파일에 대한 _execute_ 권한을 설정합니다.
+
[listing]
----
[root@demo-agent agent_installers]# chmod +x cloudsecure-agent-install.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154250 Apr 26 06:37 cloudsecure-agent-image.zip
-rwx------ 1 root root    16574 Apr 26 06:25 cloudsecure-agent-install.sh
-rw------- 1 root root     8586 Apr 26 06:25 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834705 Apr 26 14:34 cloudsecure-linux-agent-installer-1.617.0.zip

----
... 새로운 에이전트 설치를 위해 일회용 토큰을 생성합니다.
+
참고: 이 단계에서 생성된 일회용 토큰은 다음에서 생성된 API 액세스 토큰과 다릅니다.<<copy-access-token,1c 단계>> .





. Swagger에서 _cloudsecure_installers.agent > /v1/cloudsecure/agent/oneTimeToken_ API를 실행하고 응답에서 토큰을 복사합니다.
+
.. 일회용 토큰을 환경 변수로 내보냅니다.
+
[listing]
----
[root@demo-agent ~]# export TOKEN=<<one time token generated in step 7>>
----
.. 프록시 서버를 사용하는 경우 아래 언급된 형식으로 https_proxy를 환경 변수로 내보냅니다.
+
[listing]
----
[root@demo-agent ~]# export HTTPS_PROXY='USER:PASSWORD@PROXY_SERVER:PORT'
----
.. 선택 사항: 기본적으로 에이전트 및 수집기는 "/opt/netapp" 경로에 설치됩니다.  다른 경로에 설치하려면 다음 환경 변수를 설정하세요.
+
[listing]
----
[root@demo-agent ~]# export AGENT_INSTALL_PATH=/test_user/apps
----
+
참고: 사용자 지정 경로에 설치한 경우 데이터 수집기와 에이전트 로그와 같은 모든 다른 아티팩트는 사용자 지정 경로 내에만 생성됩니다.  설치 로그는 여전히 - _/var/log/netapp/cloudsecure/install_에 남아 있습니다.

.. 에이전트 설치 프로그램이 다운로드된 디렉토리로 돌아가서 "cloudsecure-agent-install.sh"를 실행하세요.
+
[listing]
----
[root@demo-agent agent_installers]# ./ cloudsecure-agent-install.sh
----
+
참고: 사용자가 "bash" 셸에서 실행하지 않는 경우 export 명령이 작동하지 않을 수 있습니다.  그런 경우 8단계부터 11단계까지를 결합하여 아래와 같이 실행할 수 있습니다.  HTTPS_PROXY와 AGENT_INSTALL_PATH는 선택 사항이므로 필요하지 않으면 무시할 수 있습니다.

+
[listing]
----
sudo /bin/bash -c "TOKEN=<<one time token generated in step 7>> HTTPS_PROXY=<<proxy details in the format mentioned in step 9>> AGENT_INSTALL_PATH=<<custom_path_to_install_agent>> ./cloudsecure-agent-install.sh"
----
+
이 시점에서 에이전트가 성공적으로 설치되었을 것입니다.

.. 에이전트 설치를 위한 정신 건강 검사:


. “systemctl status cloudsecure-agent.service”를 실행하고 에이전트 서비스가 _실행_ 상태인지 확인합니다.
+
[listing]
----
[root@demo-agent ~]# systemctl status cloudsecure-agent.service
 cloudsecure-agent.service - Cloud Secure Agent Daemon Service
   Loaded: loaded (/usr/lib/systemd/system/cloudsecure-agent.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2024-04-26 02:50:37 EDT; 12h ago
 Main PID: 15887 (java)
    Tasks: 72
   CGroup: /system.slice/cloudsecure-agent.service
           ├─15887 java -Dconfig.file=/test_user/apps/cloudsecure/agent/conf/application.conf -Dagent.proxy.host= -Dagent.proxy.port= -Dagent.proxy.user= -Dagent.proxy.password= -Dagent.env=prod -Dagent.base.path=/test_user/apps/cloudsecure/agent -...

----
. 에이전트는 "에이전트" 페이지에 표시되어야 하며 '연결됨' 상태여야 합니다.
+
image:ws_agentsPageShowingConnected.png["연결된 에이전트를 보여주는 UI"]

+
.. 설치 후 정리.


. 에이전트 설치가 성공적으로 완료되면 다운로드한 에이전트 설치 프로그램 파일을 삭제할 수 있습니다.




== 새로운 데이터 수집기를 설치합니다.

참고: 이 문서에는 "ONTAP SVM 데이터 수집기"를 설치하는 방법에 대한 지침이 포함되어 있습니다.  동일한 단계가 "Cloud Volumes ONTAP 데이터 수집기" 및 "Amazon FSx for NetApp ONTAP 데이터 수집기"에도 적용됩니다.

. 수집기를 설치해야 하는 시스템으로 이동하여 _에이전트 설치 경로_ 디렉토리 아래에 _./tmp/collectors_라는 디렉토리를 만듭니다.
+
참고: 에이전트가 _/opt/netapp_에 설치된 경우 _/opt/netapp/cloudsecure_로 이동합니다.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
. 재귀적으로 _tmp_ 디렉토리의 소유권을 *cssys:cssys*로 변경합니다(cssys 사용자 및 그룹은 에이전트 설치 중에 생성됩니다).
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp
[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors
----
. 이제 수집기 버전과 수집기의 UUID를 가져와야 합니다.  “cloudsecure_config.collector-types” API로 이동합니다.
. swagger로 이동하여 "cloudsecure_config.collector-types > /v1/cloudsecure/collector-types"(GET) API를 사용합니다.  "collectorCategory" 드롭다운에서 수집기 유형을 "DATA"로 선택합니다.  모든 수집가 유형 세부 정보를 가져오려면 "모두"를 선택하세요.
. 필요한 수집기 유형의 UUID를 복사합니다.
+
image:ws_collectorAPIShowingUUID.png["UUID를 표시하는 수집기 API 응답"]

. 수집기 설치 프로그램을 다운로드하세요.
+
.. “cloudsecure_installers.collector > /v1/cloudsecure/collector-types/installers/{collectorTypeUUID}” (GET) API로 이동합니다.  이전 단계에서 복사한 UUID를 입력하고 설치 프로그램 파일을 다운로드합니다.
+
image:ws_downloadCollectorByUUID.png["UUID로 수집기를 다운로드하는 API"]

.. 설치 프로그램 파일을 다른 컴퓨터에 외부에서 다운로드한 경우 에이전트가 실행 중인 시스템에 설치 프로그램 파일을 복사하여 _/{agent-install-path}/cloudsecure/tmp/collectors_ 디렉토리에 넣습니다.
.. 또는 동일한 API에서 curl 명령을 복사하여 수집기를 설치할 시스템에서 직접 실행할 수 있습니다.
+
파일 이름은 다운로드 수집기 API의 응답 헤더에 있는 이름과 동일해야 합니다. 아래 스크린샷을 참조하세요.

+
참고: 에이전트가 _/opt/netapp_에 설치된 경우 _/opt/netapp/cloudsecure/tmp/collectors_로 이동합니다.

+
image:ws_curl_command.png["난독화된 토큰을 보여주는 Curl 명령 예시"]

+
[listing]
----
[root@demo-agent collectors]# cd {agent-install-path}/cloudsecure/tmp/collectors
[root@demo-agent collectors]# pwd
/opt/netapp/cloudsecure/tmp/collectors

[root@demo-agent collectors]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/collector-types/installers/1829df8a-c16d-45b1-b72a-ed5707129870" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cs-ontap-dsc_1.286.0.zip
----


. 컬렉터 설치 프로그램 zip 파일의 소유권을 *cssys:cssys*로 변경합니다.
+
[listing]
----
-rw------- 1 root root 50906252 Apr 26 16:11 cs-ontap-dsc_1.286.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ontap-dsc_1.286.0.zip
[root@demo-agent collectors]# ll
total 49716
-rw------- 1 cssys cssys 50906252 Apr 26 16:11 cs-ontap-dsc_1.286.0.zip
----
. *워크로드 보안 > 수집기*로 이동하여 *+수집기*를 선택합니다.  _ONTAP SVM_ 수집기를 선택하세요.
. 수집기 세부 정보를 구성하고 수집기를 _저장_합니다.
. _저장_을 클릭하면 에이전트 프로세스가 _/{agent-install-path}/cloudsecure/tmp/collectors/_ 디렉토리에서 수집기 설치 프로그램을 찾아 수집기를 설치합니다.
. 또 다른 옵션으로, UI를 통해 수집기를 추가하는 대신 API를 통해 추가할 수도 있습니다.
+
.. “cloudsecure_config.collectors” > “/v1/cloudsecure/collectors”(POST) API로 이동합니다.
.. 예시 드롭다운에서 "ONTAP SVM 데이터 수집기 ​​JSON 샘플"을 선택하고 수집기 구성 세부 정보를 업데이트한 후 실행합니다.
+
image:ws_API_add_collector.png["수집기를 추가하는 API"]



. 이제 '데이터 수집기' 섹션에서 수집기를 볼 수 있습니다.
+
image:ws_collectorPageList.png["수집기를 보여주는 UI 목록 페이지"]

. 설치 후 정리.
+
.. 수집기 설치가 성공하면 _/{agent-install-path}/cloudsecure/tmp/collectors_ 디렉토리에 있는 모든 파일을 삭제할 수 있습니다.






== 새로운 사용자 디렉토리 수집기 설치

참고: 이 문서에서는 LDAP 수집기를 설치하는 단계를 설명했습니다.  AD 수집기를 설치하는 데에도 동일한 단계가 적용됩니다.

. 1. 수집기를 설치해야 하는 시스템으로 이동하여 _에이전트 설치 경로_ 디렉토리 아래에 _./tmp/collectors_라는 디렉토리를 만듭니다.
+
참고: 에이전트가 _/opt/netapp_에 설치된 경우 _/opt/netapp/cloudsecure_로 이동합니다.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
+
.. _collectors_ 디렉토리의 소유권을 *cssys:cssys*로 변경합니다.
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp

[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors

----


. 이제 수집기의 버전과 UUID를 가져와야 합니다.  “cloudsecure_config.collector-types” API로 이동합니다.  collectorCategory 드롭다운에서 수집기 유형을 "USER"로 선택합니다.  단일 요청으로 모든 수집기 유형 세부 정보를 가져오려면 "모두"를 선택하세요.
+
image:ws_API_collector_all.png["모든 수집기를 가져오는 API"]

. LDAP 수집기의 UUID를 복사합니다.
+
image:ws_LDAP_collector_UUID.png["LDAP 수집기 UUID를 보여주는 API 응답"]

. 수집기 설치 프로그램을 다운로드하세요.
+
.. “cloudsecure_installers.collector” > “/v1/cloudsecure/collector-types/installers/{collectorTypeUUID}” (GET) API로 이동합니다.  이전 단계에서 복사한 UUID를 입력하고 설치 프로그램 파일을 다운로드합니다.
+
image:ws_LDAP_collector_UUID_download.png["API 및 다운로드 수집기에 대한 응답"]

.. 설치 프로그램 파일을 다른 컴퓨터에 외부로 다운로드한 경우 에이전트가 실행 중인 시스템의 _/{agent-installation-path}/cloudsecure/tmp/collectors_ 디렉토리에 설치 프로그램 파일을 복사합니다.
.. 또는 동일한 API에서 curl 명령을 복사하여 수집기가 설치되어야 하는 시스템에서 직접 실행할 수 있습니다.
+
파일 이름은 다운로드 수집기 API의 응답 헤더에 있는 이름과 동일해야 합니다. 아래 스크린샷을 참조하세요.

+
또한 에이전트가 _/opt/netapp_에 설치된 경우 _/opt/netapp/cloudsecure/tmp/collectors_로 이동합니다.

+
image:ws_curl_command.png["Curl 명령 API"]



+
[listing]
----
[root@demo-agent collectors]# cd {agent-install-path}/cloudsecure/tmp/collectors
[root@demo-agent collectors]# pwd
/opt/netapp/cloudsecure/tmp/collectors

[root@demo-agent collectors]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/collector-types/installers/37fb37bd-6078-4c75-a64f-2b14cb1a1eb1" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cs-ldap-dsc_1.322.0.zip
----
. 컬렉터 설치 프로그램 zip 파일의 소유권을 cssys:cssys로 변경합니다.
+
[listing]
----
[root@demo-agent collectors]# ll
total 37156
-rw------- 1 root root 38045966 Apr 29 10:02 cs-ldap-dsc_1.322.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ldap-dsc_1.322.0.zip
[root@demo-agent collectors]# ll
total 37156
-rw------- 1 cssys cssys 38045966 Apr 29 10:02 cs-ldap-dsc_1.322.0.zip

----
. '사용자 디렉토리 수집기' 페이지로 이동하여 '+ 사용자 디렉토리 수집기'를 클릭합니다.
+
image:ws_user_directory_collector.png["사용자 디렉토리 수집기 추가"]

. 'LDAP 디렉토리 서버'를 선택합니다.
+
image:ws_LDAP_user_select.png["LDAP 사용자 선택을 위한 UI 창"]

. LDAP 디렉토리 서버 세부 정보를 입력하고 '저장'을 클릭하세요.
+
image:ws_LDAP_user_Details.png["LDAP 사용자 세부 정보를 표시하는 UI"]

. _저장_을 클릭하면 에이전트 서비스는 _/{agent-install-path}/cloudsecure/tmp/collectors/_ 디렉토리에서 수집기 설치 프로그램을 찾아 설치합니다.
. 또 다른 옵션으로, UI를 통해 수집기를 추가하는 대신 API를 통해 추가할 수도 있습니다.
+
.. “cloudsecure_config.collectors” > “/v1/cloudsecure/collectors”(POST) API로 이동합니다.
.. 예시 드롭다운에서 "LDAP 디렉토리 서버 사용자 수집기 JSON 샘플"을 선택하고 수집기 구성 세부 정보를 업데이트한 후 "실행"을 클릭합니다.
+
image:ws_API_LDAP_Collector.png["LDAP 수집기용 API"]



. 이제 수집기가 "사용자 디렉토리 수집기" 섹션에 표시되어야 합니다.
+
image:ws_LDAP_collector_list.png["UI의 LDAP 수집기 목록"]

. 설치 후 정리.
+
.. 수집기 설치가 성공하면 _/{agent-install-path}/cloudsecure/tmp/collectors_ 디렉토리에 있는 모든 파일을 삭제할 수 있습니다.






== 에이전트 업그레이드

에이전트/수집기의 새로운 버전이 출시되면 이메일 알림이 전송됩니다.

. 최신 에이전트 설치 프로그램을 다운로드하세요.
+
.. 최신 설치 프로그램을 다운로드하는 단계는 "새 에이전트 설치"의 단계와 비슷합니다.  Swagger에서 "cloudsecure_installers.agent"> "/v1/cloudsecure/agents/installers/{platform}/latest" API를 선택하고 플랫폼을 "linux"로 입력한 후 설치 프로그램 zip 파일을 다운로드합니다.  혹은 curl 명령어를 사용할 수도 있습니다.  설치 프로그램 파일의 압축을 풉니다.


. “cloudsecure-agent-upgrade.sh” 파일에 대한 실행 권한을 설정합니다.
+
[listing]
----
[root@demo-agent agent_installers]# unzip cloudsecure-linux-agent-installer-1.618.0.zip
Archive:  cloudsecure-linux-agent-installer-1.618.0.zip
  inflating: cloudsecure-agent-image.zip
  inflating: cloudsecure-agent-install.sh
  inflating: cloudsecure-agent-upgrade.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154230 Apr 26  2024 cloudsecure-agent-image.zip
-rw------- 1 root root    16574 Apr 26  2024 cloudsecure-agent-install.sh
-rw------- 1 root root     8586 Apr 26  2024 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834660 Apr 26 17:35 cloudsecure-linux-agent-installer-1.618.0.zip
[root@demo-agent agent_installers]# chmod +x cloudsecure-agent-upgrade.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154230 Apr 26  2024 cloudsecure-agent-image.zip
-rw------- 1 root root    16574 Apr 26  2024 cloudsecure-agent-install.sh
-rwx------ 1 root root     8586 Apr 26  2024 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834660 Apr 26 17:35 cloudsecure-linux-agent-installer-1.618.0.zip

----
. “cloudsecure-agent-upgrade.sh” 스크립트를 실행합니다.  스크립트가 성공적으로 실행되면 출력에 "Cloudsecure 에이전트가 성공적으로 업그레이드되었습니다."라는 메시지가 인쇄됩니다.
. 다음 명령 'systemctl daemon-reload'를 실행하세요.
+
[listing]
----
[root@demo-agent ~]# systemctl daemon-reload
----
. 에이전트 서비스를 다시 시작합니다.
+
[listing]
----
[root@demo-agent ~]# systemctl restart cloudsecure-agent.service
----
+
이 시점에서 에이전트는 성공적으로 업그레이드되었을 것입니다.

. 에이전트 업그레이드 후 정신 건강 검사를 실시합니다.
+
.. 에이전트가 설치된 경로로 이동합니다(예: “/opt/netapp/cloudsecure/”).  심볼릭 링크 "에이전트"는 새로운 버전의 에이전트를 가리켜야 합니다.
+
[listing]
----
[root@demo-agent cloudsecure]# pwd
/opt/netapp/cloudsecure
[root@demo-agent cloudsecure]# ll
total 40
lrwxrwxrwx  1 cssys cssys  114 Apr 26 17:38 agent -> /test_user/apps/cloudsecure/cloudsecure-agent-1.618.0
drwxr-xr-x  4 cssys cssys 4096 Apr 25 10:45 agent-certs
drwx------  2 cssys cssys 4096 Apr 25 16:18 agent-logs
drwx------ 11 cssys cssys 4096 Apr 26 02:50 cloudsecure-agent-1.617.0
drwx------ 11 cssys cssys 4096 Apr 26 17:42 cloudsecure-agent-1.618.0
drwxr-xr-x  3 cssys cssys 4096 Apr 26 02:45 collector-image
drwx------  2 cssys cssys 4096 Apr 25 10:45 conf
drwx------  3 cssys cssys 4096 Apr 26 16:39 data-collectors
-rw-r--r--  1 root  root    66 Apr 25 10:45 sysctl.conf.bkp
drwx------  2 root  root  4096 Apr 26 17:38 tmp

----
.. 에이전트는 "에이전트" 페이지에 표시되어야 하며 '연결됨' 상태여야 합니다.
+
image:ws_agentsPageShowingConnected.png["연결된 에이전트를 보여주는 UI"]



. 설치 후 정리.
+
.. 에이전트 설치가 성공적으로 완료되면 다운로드한 에이전트 설치 프로그램 파일을 삭제할 수 있습니다.






== 수집가 업그레이드

참고: 업그레이드 단계는 모든 유형의 수집기에 동일합니다.  이 문서에서는 "ONTAP SVM" 수집기 업그레이드를 시연합니다.

. 업그레이드해야 하는 수집기가 있는 시스템으로 이동하여 _에이전트 설치 경로_ 디렉토리 아래에 _./tmp/collectors_ 디렉토리를 만듭니다(아직 없다면).
+
참고: 에이전트가 _/opt/netapp_에 설치된 경우 _/opt/netapp/cloudsecure_ 디렉토리로 이동합니다.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
. "collectors" 디렉토리가 _cssys:cssys_의 소유인지 확인하세요.
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp
[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors
----
. Swagger에서 "cloudsecure_config.collector-types" GET API로 이동합니다.  "collectorCategory" 드롭다운에서 "DATA"를 선택합니다(사용자 디렉토리 수집기의 경우 "USER"를 선택하고, "ALL"을 선택합니다).
+
응답 본문에서 UUID와 버전을 복사합니다.

+
image:ws_collector_uuid_and_version.png["수집기 UUID 및 버전이 강조 표시된 API 응답"]

. 최신 컬렉터 설치 프로그램 파일을 다운로드하세요.
+
.. _cloudsecure_installers.collector_ > _/v1/cloudsecure/collector-types/installers/{collectorTypeUUID}_ API로 이동합니다.  이전 단계에서 복사한 _collectorTypeUUID_를 입력합니다.  설치 프로그램을 _/{agent-install-path}/cloudsecure/tmp/collectors_ 디렉토리에 다운로드합니다.
.. 또는 동일한 API의 curl 명령을 사용할 수도 있습니다.
+
image:ws_curl_command_only.png["Curl 명령 예제"]

+
참고: 파일 이름은 다운로드 수집기 API의 응답 헤더에 있는 이름과 동일해야 합니다.



. 컬렉터 설치 프로그램 zip 파일의 소유권을 cssys:cssys로 변경합니다.
+
[listing]
----
[root@demo-agent collectors]# ll
total 55024
-rw------- 1 root root 56343750 Apr 26 19:00 cs-ontap-dsc_1.287.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ontap-dsc_1.287.0.zip
[root@demo-agent collectors]# ll
total 55024
-rw------- 1 cssys cssys 56343750 Apr 26 19:00 cs-ontap-dsc_1.287.0.zip

----
. 업그레이드 수집기 API를 트리거합니다.
+
.. Swagger에서 “cloudsecure_installers.collector” > “/v1/cloudsecure/collector-types/upgrade”(PUT) API로 이동합니다.
.. "예제" 드롭다운에서 "ONTAP SVM 데이터 수집기 ​​업그레이드 JSON 샘플"을 선택하여 샘플 페이로드를 채웁니다.
.. 버전을 복사한 버전으로 교체하세요.<<copy-access-token,3단계>> '실행'을 클릭하세요.
+
image:ws_svm_ontap_collector_upgrade_example_json.png["Swagger UI의 SVM 업그레이드 예"]

+
몇 초간 기다려 보세요.  수집가는 자동으로 업그레이드됩니다.



. 정신 건강 검사.
+
수집기는 UI에서 실행 상태여야 합니다.

. 업그레이드 후 정리:
+
.. 수집기 업그레이드가 성공하면 디렉토리 _/{agent-install-path}/cloudsecure/tmp/collectors_에 있는 모든 파일을 삭제할 수 있습니다.




다른 유형의 수집기를 업그레이드하려면 위의 단계를 반복하세요.



== 공통적인 문제 및 해결 방법.

. AGENT014 오류
+
이 오류는 수집기 설치 프로그램 파일이 _/{agent-install-path}/cloudsecure/tmp/collectors_ 디렉토리에 없거나 액세스할 수 없는 경우 발생합니다.  설치 프로그램 파일이 다운로드되었고 _collectors_와 설치 프로그램 zip 파일의 전체 디렉토리 구조가 cssys:cssys의 소유인지 확인한 다음, 에이전트 서비스를 다시 시작합니다: _systemctl restart cloudsecure-agent.service_.

+
image:ws_agent014_error.png["\"에이전트 014\" 오류 호버 팁을 보여주는 UI 화면"]

. 승인되지 않은 오류
+
[listing]
----
{
  "errorMessage": "Requested public API is not allowed to be accessed by input API access token.",
  "errorCode": "NOT_AUTHORIZED"
}

----
+
필수 API 카테고리를 모두 선택하지 않고 API 액세스 토큰을 생성하면 이 오류가 표시됩니다.  모든 필수 API 카테고리를 선택하여 새로운 API 액세스 토큰을 생성합니다.


